<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <title>CSV Data Search</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Скрипт для Telegram Mini App -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    body {
      font-family: 'Inter', sans-serif;
      transition: background-color 0.3s, color 0.3s;
    }
    /* Делаем прокручиваемой только область с таблицей */
    #main-content {
        height: 100vh;
        display: flex;
        flex-direction: column;
    }
    #table-wrapper {
        flex-grow: 1; /* Занимает все оставшееся место */
        overflow-y: auto; /* Включает скролл только для этой области */
    }
    /* Стили для скроллбара */
    ::-webkit-scrollbar { width: 6px; height: 6px; }
    ::-webkit-scrollbar-track { background: #f1f1f1; }
    ::-webkit-scrollbar-thumb { background: #888; border-radius: 10px; }
    ::-webkit-scrollbar-thumb:hover { background: #555; }
    .dark ::-webkit-scrollbar-track { background: #2d3748; }
    .dark ::-webkit-scrollbar-thumb { background: #718096; }
  </style>
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-900 dark:text-gray-100 antialiased">

<!-- ======== БЛОК ДЛЯ ОГРАНИЧЕНИЯ ДОСТУПА (НОВЫЙ) ======== -->
<div id="access-denied" class="hidden fixed inset-0 bg-gray-100 dark:bg-gray-900 flex items-center justify-center z-50 text-center p-4">
    <div>
        <p class="text-2xl font-bold text-red-600 dark:text-red-500">Access Denied</p>
        <p class="mt-2 text-gray-600 dark:text-gray-400">You do not have permission to use this application.</p>
    </div>
</div>

<div id="main-content" class="mx-auto max-w-5xl">
<div id="main-content" class="mx-auto max-w-5xl">
  <!-- ======== ШАПКА И ПОИСК (теперь они фиксированные) ======== -->
  <header class="p-4 bg-gray-100 dark:bg-gray-900 border-b border-gray-200 dark:border-gray-700">
    <h1 class="text-xl sm:text-2xl font-bold text-sky-700 dark:text-sky-300 text-center">
      Data Search
    </h1>

    <!-- Блок выбора данных -->
    <div id="presets-container" class="mt-3 text-center">
       <!-- Кнопки для пресетов будут добавлены сюда JS-ом -->
    </div>
    
    <!-- Загрузка своего файла (как альтернатива) -->
    <div class="mt-3 text-center">
        <input type="file" id="fileInput" accept=".csv" class="hidden" />
        <button id="uploadButton" class="text-sm text-sky-600 dark:text-sky-400 hover:underline">
          Or load your own CSV file
        </button>
    </div>

    <div class="mt-4 relative">
      <input type="text" id="searchInput" placeholder="Search..." class="w-full p-3 pl-10 text-base border border-gray-300 dark:border-gray-600 rounded-lg shadow-sm focus:ring-2 focus:ring-sky-500 focus:border-sky-500 outline-none bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-200 placeholder-gray-400 dark:placeholder-gray-500 transition-all duration-300" />
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 dark:text-gray-500">
        <path stroke-linecap="round" stroke-linejoin="round" d="m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z" />
      </svg>
    </div>
     <div id="error-container" class="mt-2 p-2 bg-red-100 dark:bg-red-800 border border-red-300 dark:border-red-600 text-red-700 dark:text-red-200 rounded-md text-sm hidden"></div>
  </header>

  <!-- ======== ОБЛАСТЬ ТАБЛИЦЫ (прокручиваемая) ======== -->
  <div id="table-wrapper" class="p-4">
      <div id="loading-indicator" class="text-center py-4 text-gray-600 dark:text-gray-400 hidden">Processing...</div>
      
      <div id="no-results-message" class="text-center py-10 hidden">
        <p class="text-lg text-gray-600 dark:text-gray-400">No results found.</p>
      </div>

      <div class="overflow-x-auto bg-white dark:bg-gray-800 rounded-lg shadow-md">
        <table class="min-w-full text-sm">
          <thead id="table-head" class="bg-gray-50 dark:bg-gray-700 sticky top-0 z-10">
            <!-- Заголовки -->
          </thead>
          <tbody id="table-body" class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
            <!-- Данные -->
          </tbody>
        </table>
      </div>
      
       <p id="record-count" class="mt-4 text-xs text-gray-500 dark:text-gray-400 text-center"></p>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {

// ======== КОД ПРОВЕРКИ ДОСТУПА ========

// 1. Создаем "белый список" ID, которым разрешен доступ.
const ALLOWED_USER_IDS = [591135240, 1023867123, 6142000655];

try {
  const tg = window.Telegram.WebApp;
  const currentUser = tg.initDataUnsafe?.user;

  // 2. ПРОВЕРКА ДОСТУПА
  // Если приложение открыто в Telegram И ID пользователя НЕ в списке разрешенных...
  if (currentUser && !ALLOWED_USER_IDS.includes(currentUser.id)) {
    // ...тогда показываем блок "Доступ запрещен" и останавливаем выполнение скрипта.
    document.getElementById('main-content').style.display = 'none'; // Скрываем основное приложение
    document.getElementById('access-denied').classList.remove('hidden'); // Показываем ошибку
    
    // Также можно уведомить Telegram, что приложение готово, чтобы оно не "зависло"
    tg.ready(); 
    
    // ВАЖНО: Ничего больше не делаем, если доступ запрещен.
    // Оставляем пустой блок try, чтобы не было ошибок.

  } else {
    // 3. ЕСЛИ ДОСТУП РАЗРЕШЕН (или мы не в Telegram) - ЗАПУСКАЕМ ПРИЛОЖЕНИЕ
    // Этот код у вас уже был, он просто "переезжает" в блок else.

    tg.ready(); // Сообщаем, что приложение готово

    // Настраиваем тему
    const applyTheme = () => {
        document.body.classList.toggle('dark', tg.colorScheme === 'dark');
    };
    tg.onEvent('themeChanged', applyTheme);
    applyTheme(); // Применяем тему сразу

    // Настраиваем главную кнопку Telegram
    tg.MainButton.setText('Закрыть');
    tg.MainButton.setTextColor('#ffffff');
    tg.MainButton.setColor('#0ea5e9');
    tg.MainButton.show();

    // Добавляем действие на клик по этой кнопке
    tg.onEvent('mainButtonClicked', function() {
        tg.close();
    });
  }
  
} catch (e) {
  // Если приложение открыто в обычном браузере, а не в Telegram,
  // просто игнорируем ошибку и позволяем ему работать как обычно.
  console.log("Not in Telegram environment or access check skipped.");
}
  // ======== КОНЕЦ КОДА ПРОВЕРКИ ДОСТУПА ========

  // === ВСТРОЕННЫЕ ДАННЫЕ (ПРЕСЕТЫ) ===
  const PRESETS = {
    'employees': {
        name: '444 lietuvų kalbos veiksmažodiai 🇱🇹',
        data: `P,#,Инфинитив,3 л. настоящего вр.,3 л. прошедшего однократного вр.,Вопрос,Перевод инфинитива
34,1,abejóti,abejója,abejójo,kuo? / dėl ko?,сомневаться
35,2,áiškinti,áiškina,áiškino,ką? / apie ką?,"объяснять, разъяснять"
,,apsiauti,apsiauna,apsiavė,ką? / kuo?,обуваться
,,apsigyventi,apsigyvena,apsigyveno,,поселиться
,,apsinuodyti,apsinuodija,apsinuodijo,kuo?,отравиться
,,apsirengti,apsirengia,apsirengė,ką? / kuo?,одеться
36,3,apsistóti,apsistója,apsistójo,,остановиться (в значении проживать)
,,atidaryti,atidaro,atidarė,ką?,открыть
,,atiduoti,atiduoda,atidavė,ką?,отдать
37,4,atleisti,atleidžia,atleido,už ką? / kam? / ką?,"простить, уволить"
38,5,atostogáuti,atostogáuja,atostogãvo,,"находиться в отпуске, проводить каникулы"
,,atrakinti,atrakina,atrakino,ką? / kuo?,отпереть
39,6,atródyti,atródo,atródė,,казаться; выглядеть
40,7,atsakýti,atsãko,atsãkė,,"ответить, отвечать"
,,atšalti,atšąla,atšalo,,остыть
,,atsibusti,atsibunda,atsibudo,,проснуться
41,8,atsiliẽpti,atsiliẽpia,atsìliepė,į ką?,"откликнуться, откликаться; отозваться, отзываться"
,,atšilti,atšyla,atšilo,,потеплеть
42,9,atsimiñti,atsìmena,atsìminė,ką?,"вспоминать,помнить,припоминать"
43,10,atsiprašýti,atsiprãšo,atsiprãšė,ko? / už ką? / dėl ko?,"извиниться, принести извинения, просить прощения"
44,11,atsisakýti,atsisãko,atsisãkė,ko?,"отказаться, отказываться"
45,12,auginti,augina,augino,ką?,выращивать
,,augìnti,augìna,augìno,,"выращивать,растить"
46,13,áugti,áuga,áugo,,расти
47,14,áuklėti,áuklėja,áuklėjo,ką?,"воспитать, воспитывать"
,,auti,auna,avė,ką? / kuo?,обувать
48,15,aũtis,aũnasi,ãvėsi,ką? / kuo?,"обуваться, разуваться"
,,avėti,avi,avėjo,ką? / kuo?,носить обувь
49,16,bai̇g̃ti,bai̇g̃ia,bai̇g̃ė,ką?,"кончить,кончать, завершить, завершать, закончить"
50,17,baĩgtis,baĩgiasi,baĩgėsi,,"кончаться,завершаться"
51,18,bandýti,bañdo,bañdė,ką?,"пробовать, испытывать, пытаться"
,,barstyti,barsto,barstė,ką?,разбрасывать
52,19,bėgióti,bėgiója,bėgiójo,po ką?,бегать
53,20,bė́gti,bė́ga,bė́go,kuo?,бежать
54,21,bijóti,bìjo,bijójo,ko?,бояться
55,22,bučiúoti,bučiúoja,bučiãvo,ką?,целовать
56,23,bučiúotis,bučiúojasi,bučiãvosi,,целоваться
57,24,bū́ti,yrà/bū̃na,bùvo,,"быть, являться, находиться"
58,25,čiuožinė́ti,čiuožinė́ja,čiuožinė́jo,,кататься на коньках
,,čiuožti,čiuožia,čiuožė,kuo?,кататься (на чём?)
59,26,dainúoti,dainúoja,dainãvo,ką?,"петь, исполнять"
60,27,dalyváuti,dalyváuja,dalyvãvo,,"участвовать, принимать участие"
61,28,darýti,dãro,dãrė,ką?,"делать; совершать; поступать; открывать, закрывать"
63,29,dažýti,dãžo,dãžė,ką?,красить
64,30,dažýtis,dãžosi,dãžėsi,ką?,краситься
65,31,dègti,dẽga,dẽgė,ką?,"гореть; жечь, зажигать"
66,32,dėkóti,dėkója,dėkójo,ką?,благодарить
,,derėtis,derasi,derėjosi,dėl ko?,договариваться
67,33,dė́styti,dė́sto,dė́stė,ką?,"преподавать, излагать"
68,34,dė́ti,dẽda,dė́jo,ką? / ko?,класть
69,35,dėvė́ti,dėṽi,dėvė́jo,ką? / kuo?,носить (одежду)
70,36,didė́ti,didė́ja,didė́jo,,"увеличиваться, нарастать, возрастать, повышаться"
71,37,dìrbti,dìrba,dìrbo,ką?,"работать,трудиться"
72,38,domė́tis,dõmisi,domė́josi,kuo?,интересоваться
73,39,dovanóti,dovanója,dovanójo,ką? / kam?,"дарить; простить, прощать, извинить, извинять"
74,40,draugáuti,draugáuja,draugãvo,,дружить
75,41,draũsti,draũdžia,draũdė,ką? / nuo ko?,запрещать; страховать
76,42,draũstis,draũdžiasi,draũdėsi,ką?,"страховать, страховаться"
77,43,dúoti,dúoda,dãvė,ką? / kam? / ko?,"дать, давать"
78,44,džiaũgtis,džiaũgiasi,džiaũgėsi,kuo?,радоваться
79,45,džiáuti,džiáuna,džióvė,ką?,"развешивать, вешать (для просушки)"
80,46,džiovìnti,džiovìna,džiovìno,ką?,сушить
81,47,džiū́ti,džiū́sta,džiū́vo,,сохнуть; просыхать; чахнуть
82,48,eĩti,eĩna,ė̃jo,kuo?,идти
84,49,ė́sti,ė́da,ė́dė,ką?,есть (о животных)
,,filmuoti,filmuoja,filmavo,ką?,снимать фильм
,,fotografuoti,fotografuoja,fotografavo,ką?,фотографировать
85,50,galė́ti,gãli,galė́jo,,мочь
86,51,galióti,galiója,galiójo,,"быть действительным, действовать"
87,52,galvóti,galvója,galvójo,apie ką?,думать
88,53,gamìnti,gamìna,gamìno,ką?,"производить,изготовлять, готовить, приготовлять"
89,54,gáuti,gáuna,gãvo,ką?,"достать, получить, получать"
,,gerbti,gerbia,gerbė,ką?,уважать
90,55,gérti,gẽria,gė́rė,ką? / ko?,пить
91,56,gesìnti,gesìna,gesìno,ką?,тушить
93,58,gimdýti,gim̃do,gim̃dė,ką?,рожать
94,59,gìmti,gìmsta,gìmė,,"родиться,рождаться"
,,ginčytis,ginčijasi,ginčijosi,dėl ko?,спорить
95,60,gìnti,gìna,gýnė,ką?,"защитить, защищать"
96,61,girdė́ti,gir̃di,girdė́jo,ką?,слышать
98,63,grąžìnti,grąžìna,grąžìno,ką?,"вернуть, возвращать"
99,64,griáuti,griáuna,grióvė,ką?,"рушить, разрушать"
100,65,griū́ti,griū̃va,griùvo,,падать; рушиться; валиться
101,66,grį̃žti,grį̃žta,grį̃žo,,"вернуться, возвращаться"
102,67,gróti,grója,grójo,ką? / kuo?,играть (на инструменте)
,,grybauti,grybauja,grybavo,,собирать грибы
103,68,gulė́ti,gùli,gulė́jo,,лежать
104,69,gul̃tis,gùlasi,gùlėsi,,"лечь, ложиться"
92,57,gýdyti,gýdo,gýdė,ką? / nuo ko?,лечить
97,62,gyvénti,gyvẽna,gyvẽno,pas ką?,жить
,,įdė́ti,į̃deda,įdė́jo,ką? / ko?,положить
105,70,ieškóti,íeško,ieškójo,ko?,искать
106,71,įgalióti,įgaliója,įgaliójo,ką?,"доверить, доверять"
,,įjungti,įjungia,įjungė,ką?,включить
107,72,ilsė́tis,ìlsisi,ilsė́josi,,отдыхать
,,įminti,įmena,įminė,ką?,разгадать
108,73,importúoti,importúoja,importãvo,ką?,"импортировать, ввозить"
109,74,im̃ti,ìma,ė́mė,ką? / ko?,брать
110,75,informúoti,informúoja,informãvo,ką? / apie ką?,"информировать, сообщить, сообщать"
,,įpìlti,įpìla,įpýlė,ko?,наливать
,,išjungti,išjungia,išjungė,ką?,выключить
,,išmesti,išmeta,išmetė,ką?,выбросить
111,76,išmókti,išmóksta,išmóko,ką?,"выучить, научиться"
,,išnešti,išneša,išnešė,ką?,вынести
,,išrašyti,išrašo,išrašė,ką?,выписать
112,77,įžeĩsti,įžeĩdžia,į̃žeidė,ką?,оскорбить
113,78,jáudintis,jáudinasi,jáudinosi,dėl ko?,"волноваться, переживать"
114,79,jaũsti,jaũčia,jaũtė,ką?,"чувствовать, испытывать"
115,80,jaũstis,jaũčiasi,jaũtėsi,,чувствовать себя
116,81,jodinė́ti,jodinė́ja,jodinė́jo,,ездить верхом
117,82,jóti,jója,jójo,,"ехать верхом, скакать"
118,83,judė́ti,jùda,judė́jo,,шевелиться
119,84,jùngti,jùngia,jùngė,ką?,"включать; соединить, соединять"
120,85,juokáuti,juokáuja,juokãvo,,шутить
121,86,juõktis,juõkiasi,juõkėsi,iš ko?,смеяться
,,kabėti,kaba,kabėjo,,висеть
122,87,kabìnti,kabìna,kabìno,ką?,"вешать,развешивать"
123,88,kainúoti,kainúoja,kainãvo,ką?,стоить
124,89,kalbė́ti,kal̃ba,kalbė́jo,apie ką?,говорить
125,90,kalbė́tis,kal̃basi,kalbė́josi,,"разговаривать, беседовать"
126,91,kálti,kãla,kãlė,ką?,вбивать; высекать; ковать; чеканить
,,karščiuoti,karščiuoja,karščiavo,,температурить
127,92,kartóti,kartója,kartójo,ką?,повторять
128,93,kàsti,kãsa,kãsė,ką?,копать
129,94,ką́sti,kánda,kándo,ką?,"кусать, есть"
130,95,keĩsti,keĩčia,keĩtė,ką? / į ką?,менять
131,96,keĩstis,keĩčiasi,keĩtėsi,ką? / į ką?,"меняться,обмениваться"
132,97,keliáuti,keliáuja,keliãvo,į ką? / po ką?,"путешествовать, странствовать, ездить"
133,98,kélti,kẽlia,kė́lė,ką?,"поднимать, переводить"
134,99,kéltis,kẽliasi,kė́lėsi,,"вставать, подниматься; переезжать"
135,100,kèpti,kẽpa,kẽpė,ką?,"печь, жарить"
136,101,kir̃pti,ker̃pa,kir̃po,ką?,стричь; кроить; резать
139,104,kláusti,kláusia,kláusė,ką? / ko?,спрашивать
137,102,klausýti,klaũso,klaũsė,ko?,слушать; слушаться
138,103,klausýtis,klaũsosi,klaũsėsi,ko?,слушать
140,105,klijúoti,klijúoja,klijãvo,ką?,"клеить, склеивать, наклеивать"
141,106,klóti,klója,klójo,ką?,стлать; накрывать
,,koncertuoti,koncertuoja,koncertavo,,давать концерт
,,kopijuoti,kopijuoja,kopijavo,ką?,копировать
142,107,kósėti,kósti,kósėjo,,кашлять
143,108,kovóti,kovója,kovójo,dėl ko?,"бороться, сражаться"
,,kreiptis,kreipiasi,kreipėsi,į ką?,обращаться
144,109,krìsti,kriñta,krìto,,падать
145,110,kùrti,kùria,kū́rė,ką?,"сочинять, создавать, творить; писать (стихи); разводить"
146,111,kvėpúoti,kvėpúoja,kvėpãvo,kuo?,дышать
147,112,kviẽsti,kviẽčia,kviẽtė,ką?,приглашать
148,113,láidoti,láidoja,láidojo,ką?,хоронить
149,114,laikýti,laĩko,laĩkė,ką?,держать;сдавать; считать
150,115,laikýtis,laĩkosi,laĩkėsi,už ko? / ko?,держаться; соблюдать
151,116,laimė́ti,laĩmi,laimė́jo,ką?,"выиграть, выигрывать; занять, занимать"
152,117,láistyti,láisto,láistė,ką?,поливать
153,118,lankýti,lañko,lañkė,ką?,навещать; посещать
154,119,láukti,láukia,láukė,ko?,"ждать, ожидать"
155,120,láuktis,láukiasi,láukėsi,ko?,быть беременной
156,121,léisti,léidžia,léido,ką? / kam?,"разрешить, разрешать; расходовать, тратить; издавать, выпускать; пустить, пускать"
158,122,leñkti,leñkia,leñkė,ką?,"обгонять, перегонять; сгибать, наклонять; подворачивать"
160,124,liẽpti,liẽpia,liẽpė,kam?,"велеть, приказать"
161,125,liẽsti,liẽčia,liẽtė,ką?,"трогать, дотрагиваться, касаться"
163,127,lìkti,liẽka,lìko,,"остаться, оставаться"
164,128,linkė́ti,liñki,linkė́jo,ko? / kam?,желать
,,linksmintis,linksminasi,linksminosi,,веселиться
,,lipdyti,lipdo,lipdė,ką?,лепить
165,129,lìpti,lìpa,lìpo,,"лезть,подниматься; садиться, сесть"
167,131,liūdė́ti,liū̃di,liūdė́jo,dėl ko?,"грустить, печалиться"
168,132,lùpti,lùpa,lùpo,ką?,чистить; драть
169,133,lū́žti,lū́žta,lū́žo,,ломаться
159,123,lydė́ti,lỹdi,lydė́jo,ką?,"провожать, сопровождать"
162,126,lýginti,lýgina,lýgino,ką?,гладить; сравнивать
166,130,lýti,lỹja,lìjo,,идет дождь
170,134,maišýti,maĩšo,maĩšė,ką?,мешать;смешивать;путать
171,135,maitìnti,maitìna,maitìno,ką?,кормить
,,mankštintis,mankštinasi,mankštinosi,,делать упражнения
172,136,manýti,mãno,mãnė,,"думать, полагать"
,,matuoti,matuoja,matavo,ką?,измерять
174,138,matúotis,matúojasi,matãvosi,ką?,"примерять, примеривать"
173,137,matýti,mãto,mãtė,ką?,видеть
175,139,máudyti,máudo,máudė,ką?,купать
176,140,máudytis,máudosi,máudėsi,,купаться; мыться
177,141,máuti,máuna,móvė,ką?,"одеть, одевать; снять, снимать"
178,142,máutis,máunasi,móvėsi,ką?,"надеть, надевать; снять, снимать"
179,143,mažė́ti,mažė́ja,mažė́jo,ko?,"уменьшаться, убывать, снижаться"
180,144,medžióti,medžiója,medžiójo,ką?,охотиться
181,145,mė́gti,mė́gsta,mė́go,ką?,любить
182,146,mègzti,mẽzga,mẽzgė,ką?,вязать
183,147,mel̃stis,mel̃džiasi,mel̃dėsi,kam?,молиться
184,148,melúoti,melúoja,melãvo,apie ką?,лгать
185,149,mèsti,mẽta,mẽtė,ką?,"бросить, кинуть"
186,150,miegóti,miẽga,miegójo,,спать
188,152,mir̃ti,mìršta,mìrė,,"умереть,умирать,скончаться"
189,153,mokė́ti,móka,mokė́jo,ką?,"знать, уметь; платить, уплачивать"
190,154,mókyti,móko,mókė,ko? / ką?,"учить, обучать"
191,155,mókytis,mókosi,mókėsi,ko? / ką?,"учиться, изучать, заниматься"
192,156,mùšti,mùša,mùšė,ką?,бить
187,151,mylė́ti,mýli,mylė́jo,ką?,любить
,,nakvoti,nakvoja,nakvojo,,ночевать
193,157,naudóti,naudója,naudójo,ką? / kam?,"употреблять, пользовать, применять"
194,158,naudótis,naudójasi,naudójosi,kuo?,"пользоваться, использовать"
195,159,nekę̃sti,nekeñčia,nèkentė,ko? / už ką?,ненавидеть
196,160,nèrvinti,nèrvina,nèrvino,ką?,раздражать
197,161,nèrvintis,nèrvinasi,nèrvinosi,dėl ko?,нервничать
198,162,nešióti,nešiója,nešiójo,ką?,носить
199,163,nèšti,nẽša,nẽšė,ką?,нести
200,164,norė́ti,nóri,norė́jo,ko?,хотеть
201,165,nugalė́ti,nùgali,nugalė́jo,ką?,"пересилить, пересиливать; одолеть, преодолеть; победить, побеждать"
202,166,núomoti,núomoja,núomojo,ką? / kam?,"сдать, сдавать внаем"
,,nusiauti,nusiauna,nusiavė,ką?,разуваться
,,nusirengti,nusirengia,nusirengė,ką?,раздеваться
203,167,nusprę́sti,nuspréndžia,nuspréndė,,"решить, решать"
204,168,nustèbti,nustem̃ba,nustẽbo,dėl ko?,"удивиться, удивляться"
205,169,pabùsti,pabuñda,pabùdo,,"проснуться, просыпаться, пробудиться, пробуждаться"
206,170,padė́ti,pàdeda,padė́jo,kam?,"помочь, помогать, оказать помощь оказывать помощь"
,,paduoti,paduoda,padavė,ką? / ko?,подать
207,171,pakúoti,pakúoja,pakãvo,ką?,"паковать, упаковывать, укладывать"
208,172,pamir̃šti,pamir̃šta,pamir̃šo,ką?,"забыть, забывать"
209,173,pardúoti,pardúoda,par̃davė,ką?,"продать, продавать"
,,parodyti,parodo,parodė,ką?,показать
210,174,pãsakoti,pãsakoja,pãsakojo,ką? / apie ką?,"рассказывать, повествовать"
,,pasiilgti,pasiilgsta,pasiilgo,ko?,скучать по
211,175,pasiklýsti,pasiklýsta,pasiklýdo,,заблудиться
,,pašildyti,pašildo,pašildė,ką?,подогреть
,,pasimatuoti,pasimatuoja,pasimatavo,ką?,примерить
212,176,pasirašýti,pasirãšo,pasirãšė,ką?,"подписаться, подписываться, расписаться, расписываться, подписать, подписывать"
213,177,pasitìkti,pasitiñka,pasitìko,ką?,"встретить,встречать"
214,178,pastebė́ti,pàstebi,pastebė́jo,ką?,"заметить, замечать, приметить, примечать, подметить, подмечать"
,,pasveikti,pasveiksta,pasveiko,,выздороветь
,,patarti,pataria,patarė,kam?,советовать
215,179,patìkti,patiñka,patìko,kas? / kam?,"нравиться, понравиться"
216,180,pavar̃gti,pavar̃gsta,pavar̃go,nuo ko?,"устать, уставать"
217,181,pavydė́ti,pavýdi,pavydė́jo,ko? / kam?,завидовать
218,182,pažeĩsti,pažeĩdžia,pàžeidė,ką?,"нарушить, нарушать"
219,183,pažìnti,pažį́sta,pažìno,ką?,"знать, быть знакомым"
220,184,peršalti,peršąla,peršalo,ką?,простудиться
,,persikelti,persikelia,persikėlė,iš ko? / į ką?,переселиться
,,piẽšti,piẽšia,piẽšė,ką?,рисовать
221,185,pietáuti,pietáuja,pietãvo,,обедать
,,pildyti,pildo,pildė,ką?,заполнять
224,188,pìlti,pìla,pýlė,ką? / ko?,"лить, наливать"
,,pinti,pina,pynė,ką?,плести
225,189,pir̃kti,per̃ka,pir̃ko,ką? / ko?,"купить, покупать"
,,pjaustyti,pjausto,pjaustė,ką?,нарезать
226,190,pjáuti,pjáuna,pjóvė,ką?,резать; пилить; косить
227,191,planúoti,planúoja,planãvo,ką?,планировать
228,192,pláukioti,pláukioja,pláukiojo,,плавать
229,193,plaũkti,plaũkia,plaũkė,kuo? / į ką?,плыть
230,194,pláuti,pláuna,plóvė,ką?,"мыть, умывать"
231,195,pláutis,pláunasi,plóvėsi,ką?,мыть
,,ploti,ploja,plojo,,аплодировать
232,196,plýšti,plýšta,plýšo,,"рваться, разрываться"
233,197,pradė́ti,pràdeda,pradė́jo,ką?,"начать, начинать"
,,pralaimėti,pralaimi,pralaimėjo,ką?,проигрывать
234,198,pranèšti,pràneša,prànešė,ką?,"сообщить, сообщать, известить, извещать"
235,199,prasidė́ti,prasìdeda,prasidė́jo,,"начаться, начинаться"
236,200,prašýti,prãšo,prãšė,ką? / ko?,просить
237,201,praũsti,praũsia,praũsė,ką?,"мыть, умывать"
238,202,praũstis,praũsiasi,prausėsi,ką?,"мыться, умываться"
,,priimti,priima,priėmė,ką?,принимать
239,203,pripràsti,priprañta,priprãto,prie ko?,"привыкнуть, привыкать"
240,204,pristatýti,pristãto,pristãtė,ką?,"представить, представлять"
241,205,privalė́ti,privãlo,privalė́jo,,"быть должным, быть обязанным"
242,206,puõšti,puõšia,puõšė,ką?,"украшать, наряжать"
243,207,puõštis,puõšiasi,puošėsi,,наряжаться
244,208,pùsryčiauti,pùsryčiauja,pùsryčiavo,,завтракать
245,209,pū̃sti,pùčia,pū̃tė,ką?,"дуть, веять; раздуть, надувать"
222,186,pỹkti,pỹksta,pỹko,ant ko?,"сердиться, злиться"
223,187,pỹktis,pỹkstasi,pỹkosi,su kuo?,"ссориться, быть в ссоре"
,,ragauti,ragauja,ragavo,ką? / ko?,пробовать
246,210,rakìnti,rakìna,rakìno,ką?,"запирать,замыкать, отпирать, отмыкать"
247,211,ramìnti,ramìna,ramìno,ką?,"успокоить,успокаивать"
248,212,ràsti,rañda,rãdo,ką?,"найти, находить"
249,213,rašýti,rãšo,rãšė,ką?,писать
250,214,registrúoti,registrúoja,registrãvo,ką?,регистрировать
251,215,reikaláuti,reikaláuja,reikalãvo,ko? / iš ko?,требовать
252,216,reikė́ti,reĩkia,reikė́jo,ko? / kam?,"быть нужным, требоваться, нуждаться"
253,217,réikšti,réiškia,réiškė,ką? / kam? / kas?,"значить, означать; выражать"
254,218,rė̃kti,rė̃kia,rė̃kė,ant ko? / iš ko?,"кричать, орать"
255,219,reñgti,reñgia,reñgė,ką?,готовить
256,220,reñgti,reñgia,reñgė,ką? / kuo?,"одевать, раздевать"
257,221,reñgtis,reñgiasi,reñgėsi,ką? / kuo?,"надевать, раздевать"
258,222,riñkti,reñka,riñko,ką? / kuo?,собирать; выбирать; избирать
259,223,riñktis,reñkasi,riñkosi,ką?,выбирать; собираться
260,224,rìšti,rìša,rìšo,ką?,"связывать, завязывать, привязывать, перевязывать"
261,225,ródyti,ródo,ródė,ką?,покaзывать
262,226,rūkýti,rū̃ko,rū̃kė,ką?,курить; коптить
263,227,rungtyniáuti,rungtyniáuja,rungtyniãvo,su kuo?,"состязаться, соревноваться"
264,228,ruõšti,ruõšia,ruõšė,ką? / į ką?,готовить; собирать
265,229,ruõštis,ruõšiasi,ruõšėsi,kam? / į ką?,готовиться; собираться
266,230,rūpė́ti,rū̃pi,rūpė́jo,kas?,заботить; интересовать
267,231,rū́pintis,rū́pinasi,rū́pinosi,kuo?,"заботиться, беспокоиться"
,,rūšiuoti,rūšiuoja,rūšiavo,ką?,сортировать
268,232,sakýti,sãko,sãkė,ką?,говорить
326,288,šálti,šą̃la,šãlo,,"мерзнуть, замерзать; морозить"
269,233,sapnúoti,sapnúoja,sapnãvo,ką?,"видеть во сне, сниться"
270,234,sáugoti,sáugo,sáugojo,ką? / nuo ko?,"охранять, стеречь; беречь; хранить"
327,289,šaũkti,šaũkia,šaũkė,ant ko? / ką?,кричать; звать; созывать; вызывать
328,290,šáuti,šáuna,šóvė,ką? / į ką?,стрелять
271,235,sėdė́ti,sė́di,sėdė́jo,,сидеть
272,236,sègti,sẽga,sẽgė,ką?,застегивать; прикалывать пристегивать
273,237,sèkti,sẽka,sẽkė,ką? / kuo? / paskui ką?,следить; следовать
274,238,sèktis,sẽkasi,sẽkėsi,kas?,"даваться, везти"
275,239,sénti,sénsta,sẽno,,"стареть, стариться"
329,291,šérti,šẽria,šė́rė,ką?,кормить (животных)
276,240,sė́sti,sė́da,sė́do,,"сесть, садиться"
277,241,síekti,síekia,síekė,ko?,"доставать, тянуться; достигать, добиваться"
330,292,šìldyti,šìldo,šìldė,ką? / ko?,"греть, подогревать, обогревать"
331,293,šìlti,šỹla,šìlo,,"теплеть, согреваться"
278,242,sir̃gti,ser̃ga,sir̃go,kuo?,болеть
279,243,siū́lyti,siū́lo,siū́lė,ką? / ko?,предлагать
,,siurbti,siurbia,siurbė,ką?,пылесосить
280,244,sių̃sti,siuñčia,siuñtė,ką? / ko? / kuo?,"слать, посылать; отправлять"
281,245,siū́ti,siùva,siùvo,ką? / kuo?,шить
282,246,skaičiúoti,skaičiúoja,skaičiãvo,ką? / kuo?,считать; насчитывать
283,247,skaitýti,skaĩto,skaĩtė,ką?,читать
284,248,skal̃bti,skal̃bia,skal̃bė,ką?,стирать
285,249,skam̃binti,skam̃bina,skam̃bino,kam?,звонить
286,250,skaudė́ti,skaũda,skaudė́jo,ką? / kam?,болеть
287,251,skélbti,skélbia,skélbė,ką?,"объявлять, сообщать, оглашать"
288,252,skę̃sti,skę̃sta,skeñdo,,тонуть
289,253,skìrti,skìria,skýrė,ką? / ko? / kuo?,"делить;различать,отличать;предназначать, посвятить, посвящать; назначить, назначать"
291,254,skìrtis,skìriasi,skýrėsi,nuo ko? / iš ko? / su kuo?,"отличаться,разводиться"
292,255,skõlinti,skõlina,skõlino,ką? / kam? / ko?,"одалживать, давать взаймы"
,,skolintis,skolinasi,skolinosi,ką?,брать взаймы
293,256,skrìsti,skreñda,skrìdo,kuo?,лететь
294,257,skubė́ti,skùba,skubė́jo,,"спешить, торопиться"
295,258,skùsti,skùta,skùto,ką? / kuo?,чистить; брить
296,259,skų́sti,skùndžia,skùndė,ką?,ябедничать; доносить
,,skustis,skutasi,skutosi,ką?,бриться
297,260,skų́stis,skùndžiasi,skùndėsi,kuo?,жаловаться
298,261,slidinė́ti,slidinė́ja,slidinė́jo,kuo?,кататься на лыжах
,,sloguoti,sloguoja,slogavo,,болеть простудой
333,295,šlúostyti,šlúosto,šlúostė,ką?,"вытирать, утирать"
334,296,šlúoti,šlúoja,šlãvė,ką?,"мести, подметать"
335,297,šnekė́ti,šnẽka,šnekė́jo,ką? / apie ką?,говорить
299,262,snìgti,sniñga,snìgo,,идет / падает снег
300,263,sodìnti,sodìna,sodìno,ką?,"садить,сажать"
336,298,šókti,šóka,šóko,ką? / su kuo?,танцевать; прыгнуть
301,264,spáusdinti,spáusdina,spáusdino,ką?,печатать
302,265,spė́ti,spė́ja,spė́jo,į ką?,успевать
303,266,sportúoti,sportúoja,sportãvo,,заниматься спортом
304,267,sprę̃́sti,spréndžia,spréndė,ką?,решать
305,268,stabdýti,stãbdo,stãbdė,ką?,останавливать
306,269,statýti,stãto,stãtė,ką?,строить; ставить
308,270,stebė́ti,stẽbi,stebė́jo,ką?,наблюдать
309,271,stebė́tis,stẽbisi,stebė́josi,kuo?,"удивляться, изумляться, поражаться"
,,stengtis,stengiasi,stengėsi,,стараться
310,272,stóti,stója,stójo,į ką?,становиться; останавливаться; поступать; вступать
311,273,stótis,stójasi,stójosi,,"встать, вставать"
312,274,stovė́ti,stóvi,stovė́jo,,стоять
313,275,studijúoti,studijúoja,studijãvo,ką?,"учить, изучать, изучить"
314,276,sùkti,sùka,sùko,ką?,"крутить, кружить; поворачивать; вить"
315,277,sùktis,sùkasi,sùkosi,aplink ką?,"крутиться, кружиться; разворачиваться"
337,299,šukúoti,šukúoja,šukãvo,ką?,причесывать
338,300,šukúotis,šukúojasi,šukãvosi,ką?,"причесываться, расчесывать"
,,sumanyti,sumano,sumanė,ką?,придумать
316,278,supažìndinti,supažìndina,supažìndino,ką? / su kuo?,познакомить; ознакомить
317,279,supràsti,suprañta,suprãto,ką?,"понять, понимать"
,,susegti,susega,susegė,ką?,скрепить
,,susilaužyti,susilaužo,susilaužė,ką?,сломать
318,280,susipažìnti,susipažį́sta,susipažìno,su kuo?,познакомиться;ознакомиться
,,susirinkti,susirenka,susirinko,,собраться
,,susitaikyti,susitaiko,susitaikė,su kuo?,помириться
319,281,susitìkti,susitiñka,susitìko,ką? / su kuo?,"встретиться,встречаться"
,,susižeisti,susižeidžia,susižeidė,ką?,пораниться
320,282,sutìkti,sutiñka,sutìko,ką? / su kuo?,встретить;согласиться
321,283,svajóti,svajója,svajójo,apie ką?,мечтать
322,284,svéikinti,svéikina,svéikino,ką?,поздравлять
323,285,svéikintis,svéikinasi,svéikinosi,su kuo?,здороваться
324,286,sveĩkti,sveĩksta,sveĩko,,выздоравливать
325,287,sver̃ti,svẽria,svė̃rė,ką?,взвешивать; весить
339,301,švę̃sti,šveñčia,šveñtė,ką?,праздновать
340,302,šviẽsti,šviẽčia,šviẽtė,ką?,светить; просвещать
332,294,šypsótis,šỹpsosi,šypsójosi,kam?,улыбаться
341,303,taisýti,taĩso,taĩsė,ką?,"ремонтировать, исправлять, чинить"
343,305,tàpti,tam̃pa,tãpo,kuo?,стать
342,304,tapýti,tãpo,tãpė,ką?,писать (красками)
344,306,tar̃ti,tãria,tãrė,ką?,"произнести, произносить, выговаривать"
,,tartis,tariasi,tarėsi,su kuo? / dėl ko?,договариваться
345,307,taupýti,taũpo,taũpė,ką? / kam?,"копить, экономить"
346,308,teĩgti,teĩgia,teĩgė,,утверждать
347,309,teiráutis,teiráujasi,teirãvosi,ko?,"справляться, узнавать"
348,310,teĩsti,teĩsia,teĩsė,ką? / už ką?,судить
349,311,tekė́ti,tẽka,tekė́jo,už ko? / į ką? / iš ko?,"течь, литься; выходить замуж; всходить (о солнце)"
350,312,tèpti,tẽpa,tẽpė,ką? / ko? / ant ko?,"мазать, смазывать; пачкать"
351,313,tikė́ti,tìki,tikė́jo,kuo? / ką?,верить
352,314,tikė́tis,tìkisi,tikė́josi,ko?,надеяться
,,tikrinti,tikrina,tikrino,ką?,проверять
353,315,tìkti,tiñka,tìko,kas? / kam?,"годиться,подходить"
355,317,til̃pti,tel̃pa,til̃po,į ką?,"поместиться, помещаться"
356,318,tingė́ti,tìngi,tingė́jo,,лениться
357,319,tir̃pti,tir̃psta,tir̃po,,"таять, растаивать; растворяться; неметь"
358,320,tìrti,tìria,týrė,ką?,"расследовать, обследовать"
,,trinti,trina,trynė,ką?,тереть
359,321,triukšmáuti,triukšmáuja,triukšmãvo,,шуметь
360,322,trukdýti,trùkdo,trùkdė,kam?,"мешать, беспокоить"
361,323,trùkti,truñka,trùko,,длиться
362,324,trū́kti,trū́ksta,trū́ko,ko? / kam?,"рваться; недоставать, не хватать"
363,325,tuõktis,tuõkiasi,tuõkėsi,su kuo?,"вступать в брак, бракосочетаться, венчаться"
364,326,tupė́ti,tùpi,tupė́jo,,сидеть (о птицах); сидеть на корточках (о человеке)
365,327,turė́ti,tùri,turė́jo,ką? / ko?,иметь; быть должным
366,328,tvarkýti,tvar̃ko,tvarkė,ką?,убирать; управлять
354,316,tylė́ti,tỹli,tylė́jo,,молчать
367,329,ūkininkáuti,ūkininkáuja,ūkininkãvo,,"хозяйствовать, заниматься хозяйством"
368,330,uogáuti,uogáuja,uogãvo,,собирать ягоды
369,331,uždaryti,uždaro,uždarė,ką?,закрыть
,,užmìgti,užmiñga,užmìgo,,"засыпать,уснуть"
,,užpildyti,užpildo,užpildė,ką?,заполнить
,,užrakinti,užrakina,užrakino,ką?,закрыть на замок
,,užsikrėsti,užsikrečia,užsikrėtė,kuo?,заразиться
,,užsisakyti,užsisako,užsisakė,ką?,заказать
370,332,vadìnti,vadìna,vadìno,ką? / kuo?,"называть,звать"
371,333,vadováuti,vadováuja,vadovãvo,kam?,руководить
372,334,vaidìnti,vaidìna,vaidìno,ką?,"играть(насцене), исполнять роль, изображать"
373,335,váikščioti,váikščioja,váikščiojo,kuo? / po ką?,ходить; гулять
374,336,vairúoti,vairúoja,vairãvo,ką?,"вести, водить (о транспорте), управлять"
375,337,váišinti,váišina,váišino,ką? / kuo?,угощать
376,338,vakarieniáuti,vakarieniáuja,vakarieniãvo,,ужинать
377,339,válgyti,válgo,válgė,ką? / ko?,"есть, кушать"
378,340,valýti,vãlo,vãlė,ką?,"чистить, очищать, убирать"
,,valytis,valosi,valėsi,ką?,чиститься
379,341,vartóti,vartója,vartójo,ką?,"принимать (лекарства), употреблять, потреблять; использовать, пользоваться"
380,342,važinė́ti,važinė́ja,važinė́jo,,"ездить, разъезжать, катать"
381,343,važiúoti,važiúoja,važiãvo,kuo?,ехать
382,344,veĩkti,veĩkia,veĩkė,ką?,делать;действовать;влиять
383,345,vėlúoti,vėlúoja,vėlãvo,į ką?,опаздывать
,,verkti,verkia,verkė,,плакать
384,346,ver̃sti,ver̃čia,ver̃tė,ką? / iš ko? / į ką?,"валить;переворачивать;переводить; заставлять, принуждать; превращать; опрокидывать"
386,347,vértinti,vértina,vértino,ką?,ценить; оценивать
387,348,vèsti,vẽda,vẽdė,ką?,"вести, водить; жениться; плодоносить; приносить (младенца)"
389,349,vèžti,vẽža,vẽžė,ką? / kuo?,"везти, возить"
391,351,vilkė́ti,vil̃ki,vilkė́jo,ką? / kuo?,"носить (об одежде), быть одетым"
392,352,vil̃ktis,vel̃kasi,vil̃kosi,ką? / kuo?,"надевать, одеваться"
393,353,vìrti,vérda,vìrė,ką? / ko?,кипеть; варить
394,354,võgti,vãgia,võgė,ką?,красть
390,350,vỹkti,vỹksta,vỹko,kuo?,"направляться, отправляться; происходить, проходить"
395,355,žadė́ti,žãda,žadė́jo,ką?,обещать
396,356,žãdinti,žãdina,žãdino,ką?,будить; пробуждать; возбуждать
397,357,žaibúoti,žaibúoja,žaibãvo,,сверкать (о молнии)
398,358,žaĩsti,žaĩdžia,žaĩdė,ką? / kuo?,играть
399,359,žeĩsti,žeĩdžia,žeĩdė,ką?,ранить
401,361,žinóti,žìno,žinójo,ką?,знать
402,362,žiūrė́ti,žiū̃ri,žiūrė́jo,ką? / į ką? / pro ką? / ko?,"смотреть, глядеть"
404,363,žudýti,žùdo,žùdė,ką?,"убивать, истреблять, губить"
405,364,žū́ti,žū́sta,žùvo,,"гибнуть, погибать"
406,365,žvejóti,žvejója,žvejójo,ką?,"ловить (рыбу), рыбачить"
400,360,žydė́ti,žýdi,žydė́jo,,цвести`
    },
    'cities': {
        name: 'World Cities 🌍',
        data: `City,Country,Population
Tokyo,Japan,37435191
Delhi,India,29399141
Shanghai,China,26317104
Sao Paulo,Brazil,21846507
Mexico City,Mexico,21671908
Cairo,Egypt,20484965
Mumbai,India,20185064
Beijing,China,20035455`
    }
  };

  // === ГЛОБАЛЬНЫЕ ПЕРЕМЕННЫЕ ===
  let allData = [];
  let headers = [];
  let activePresetKey = Object.keys(PRESETS)[0]; // По умолчанию активен первый пресет

  // === ССЫЛКИ НА ЭЛЕМЕНТЫ DOM ===
  const searchInput = document.getElementById('searchInput');
  const fileInput = document.getElementById('fileInput');
  const uploadButton = document.getElementById('uploadButton');
  const tableHead = document.getElementById('table-head');
  const tableBody = document.getElementById('table-body');
  const loadingIndicator = document.getElementById('loading-indicator');
  const noResultsMessage = document.getElementById('no-results-message');
  const errorContainer = document.getElementById('error-container');
  const recordCount = document.getElementById('record-count');
  const presetsContainer = document.getElementById('presets-container');

// === ИНТЕГРАЦИЯ С TELEGRAM MINI APP ===
try {
  const tg = window.Telegram.WebApp;
  tg.ready(); // 1. Сообщаем, что приложение готово

  // 2. Настраиваем тему
  const applyTheme = () => {
      document.body.classList.toggle('dark', tg.colorScheme === 'dark');
  };
  tg.onEvent('themeChanged', applyTheme);
  applyTheme(); // Применяем тему сразу

  // 3. Настраиваем главную кнопку Telegram (вот что нужно добавить)
  tg.MainButton.setText('Закрыть');      // Задаем текст кнопки
  tg.MainButton.setTextColor('#ffffff'); // Цвет текста (белый)
  tg.MainButton.setColor('#0ea5e9');   // Цвет кнопки (в стиле sky-500 из Tailwind)
  tg.MainButton.show();                // Показываем кнопку

  // 4. Добавляем действие на клик по этой кнопке
  tg.onEvent('mainButtonClicked', function() {
      tg.close(); // Команда для закрытия Mini App
  });

} catch (e) {
  console.log("Not in Telegram environment."); // Этот блок сработает, если открыть в обычном браузере
}

  // === ВСПОМОГАТЕЛЬНЫЕ ФУНКЦИИ (без изменений) ===
  const normalizeString = (str) => {
    return str.normalize('NFD').replace(/[\u0300-\u036f]/g, '').toLowerCase();
  };

  const parseCSVLine = (line) => {
    const result = [];
    let currentField = "";
    let inQuotedField = false;
    for (let i = 0; i < line.length; i++) {
      const char = line[i];
      if (char === '"') {
        if (inQuotedField && i + 1 < line.length && line[i + 1] === '"') {
          currentField += '"'; i++;
        } else {
          inQuotedField = !inQuotedField;
        }
      } else if (char === ',' && !inQuotedField) {
        result.push(currentField); currentField = "";
      } else {
        currentField += char;
      }
    }
    result.push(currentField);
    return result;
  };

  const parseCSV = (csvString) => {
    const lines = csvString.trim().split('\n').filter(line => line.trim() !== '');
    if (lines.length === 0) return { headers: [], data: [] };
    const parsedHeaders = parseCSVLine(lines[0]).map(header => header.trim());
    const parsedData = lines.slice(1).map(line => {
      const values = parseCSVLine(line);
      const row = {};
      parsedHeaders.forEach((header, index) => {
        row[header] = values[index] !== undefined ? values[index].trim() : '';
      });
      return row;
    });
    return { headers: parsedHeaders, data: parsedData };
  };

  // === ФУНКЦИИ РЕНДЕРИНГА И ОБНОВЛЕНИЯ UI ===
  const showError = (message) => {
      errorContainer.textContent = message;
      errorContainer.classList.remove('hidden');
  };

  const hideError = () => {
      errorContainer.classList.add('hidden');
  };

  const renderTable = (dataToRender) => {
    tableHead.innerHTML = '';
    tableBody.innerHTML = '';

    if (headers.length === 0) return;

    const headerRow = document.createElement('tr');
    headers.forEach(headerText => {
      const th = document.createElement('th');
      th.className = 'px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider';
      th.textContent = headerText;
      headerRow.appendChild(th);
    });
    tableHead.appendChild(headerRow);

    dataToRender.forEach(row => {
      const tr = document.createElement('tr');
	 tr.className = 'even:bg-gray-50 dark:even:bg-slate-800 hover:bg-sky-100 dark:hover:bg-sky-900 transition-colors duration-150';
      headers.forEach(header => {
        const td = document.createElement('td');
        td.className = 'px-4 py-2 whitespace-nowrap md:whitespace-normal text-gray-700 dark:text-gray-300';
        td.textContent = row[header];
        tr.appendChild(td);
      });
      tableBody.appendChild(tr);
    });
    
    noResultsMessage.classList.toggle('hidden', dataToRender.length > 0);
    const searchTerm = searchInput.value.trim();
    if (dataToRender.length === 0 && searchTerm) {
        noResultsMessage.querySelector('p').textContent = `No results for "${searchTerm}"`;
    } else if (dataToRender.length === 0) {
        noResultsMessage.querySelector('p').textContent = `Data is empty`;
    }
    
    if (dataToRender.length > 0) {
        recordCount.textContent = `Showing ${dataToRender.length} of ${allData.length}`;
    } else {
        recordCount.textContent = '';
    }
  };

  const processData = (csvString) => {
      loadingIndicator.classList.remove('hidden');
      hideError();
      setTimeout(() => { // Имитация задержки для показа индикатора
        try {
            const { headers: parsedHeaders, data: parsedData } = parseCSV(csvString);
            if (parsedHeaders.length === 0) {
                showError("Failed to parse data. Check format.");
                return;
            }
            headers = parsedHeaders;
            allData = parsedData;
            searchInput.value = '';
            renderTable(allData);
        } catch (e) {
            console.error("Parsing error:", e);
            showError("A critical error occurred during parsing.");
        } finally {
            loadingIndicator.classList.add('hidden');
        }
      }, 50);
  };
  
  // === Создание кнопок для пресетов ===
  const renderPresetButtons = () => {
    presetsContainer.innerHTML = '';
    Object.keys(PRESETS).forEach(key => {
        const preset = PRESETS[key];
        const button = document.createElement('button');
        const isActive = key === activePresetKey;
        
        button.textContent = preset.name;
        button.dataset.key = key;
        button.className = `px-3 py-1.5 text-sm rounded-full mr-2 mb-2 transition-colors duration-200 ${
            isActive 
            ? 'bg-sky-600 text-white font-semibold' 
            : 'bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 hover:bg-gray-300 dark:hover:bg-gray-600'
        }`;
        
        button.addEventListener('click', () => {
            activePresetKey = key;
            processData(PRESETS[key].data);
            renderPresetButtons(); // Перерисовать кнопки, чтобы показать активную
        });
        
        presetsContainer.appendChild(button);
    });
  }

  // === ОБРАБОТЧИКИ СОБЫТИЙ ===
  searchInput.addEventListener('input', (event) => {
    const searchTerm = event.target.value.trim();
    if (!searchTerm) {
      renderTable(allData);
      return;
    }
    const normalizedSearchTerm = normalizeString(searchTerm);
    const filteredData = allData.filter(row =>
      Object.values(row).some(cellValue =>
        normalizeString(String(cellValue)).includes(normalizedSearchTerm)
      )
    );
    renderTable(filteredData);
  });
  
  uploadButton.addEventListener('click', () => fileInput.click());

  fileInput.addEventListener('change', (event) => {
    const file = event.target.files?.[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = (e) => {
        processData(e.target?.result);
        // Сбрасываем активный пресет, т.к. загружен кастомный файл
        activePresetKey = null; 
        renderPresetButtons();
    };
    reader.onerror = () => showError("Failed to read file.");
    reader.readAsText(file);
    event.target.value = '';
  });

  // === НАЧАЛЬНАЯ ЗАГРУЗКА ===
  renderPresetButtons();
  processData(PRESETS[activePresetKey].data); // Загружаем данные первого пресета по умолчанию

});
</script>

</body>
</html>
